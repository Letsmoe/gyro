var e={d:(r,t)=>{for(var n in t)e.o(t,n)&&!e.o(r,n)&&Object.defineProperty(r,n,{enumerable:!0,get:t[n]})},o:(e,r)=>Object.prototype.hasOwnProperty.call(e,r)},r={};e.d(r,{qA:()=>u,AV:()=>t,qd:()=>n,Cr:()=>o,ku:()=>s,Qc:()=>a});class t{constructor(e){this.input=e,this.pos=0,this.line=1,this.col=0}next(){var e=this.input.charAt(this.pos++);return"\n"==e?(this.line++,this.col=0):this.col++,e}peek(e=0){return this.input.charAt(this.pos+e)}eof(){return""==this.peek()}reset(){this.pos=0,this.line=0,this.col=0}croak(e){console.error(e+" ("+this.line+":"+this.col+")")}}class n{constructor(e){this.stream=e,this.KEYWORDS=["if","else","while","let","const","func","then","for","import","export","from","in","do"]}isKeyword(e){return this.KEYWORDS.indexOf(e)>=0}isDigit(e){return/[0-9]/i.test(e)}isIdentifierStart(e){return/[a-zλ_]/i.test(e)}isIdentifier(e){return this.isIdentifierStart(e)||"?!-<>0123456789".indexOf(e)>=0}isOperatorChar(e){return["+","-","*","/","%","=","&","|","<",">","!"].indexOf(e)>=0}isPunctuation(e){return",;(){}[]".indexOf(e)>=0}isWhitespace(e){return" \t\n".indexOf(e)>=0}readWhile(e){for(var r="";!this.stream.eof()&&e(this.stream.peek());)r+=this.stream.next();return r}readNumber(){var e=!1,r=this.readWhile((r=>"."==r?!e&&(e=!0,!0):this.isDigit(r)));return{type:"number",value:parseFloat(r)}}readIdentifier(){var e=this.readWhile(this.isIdentifier.bind(this));return{type:this.isKeyword(e)?"keyword":"identifier",value:e}}readEscaped(e){var r=!1,t="";for(this.stream.next();!this.stream.eof();){var n=this.stream.next();if(r)t+=n,r=!1;else if("\\"==n)r=!0;else{if(n==e)break;t+=n}}return t}readString(){return{type:"string",value:this.readEscaped('"')}}skipComment(){this.readWhile((function(e){return"\n"!=e})),this.stream.next()}readNext(){if(this.readWhile(this.isWhitespace),this.stream.eof())return null;var e=this.stream.peek();return"#"==e?(this.skipComment(),this.readNext()):'"'==e?this.readString():this.isDigit(e)?this.readNumber():this.isIdentifierStart(e)?this.readIdentifier():this.isPunctuation(e)?{type:"punctuation",value:this.stream.next()}:this.isOperatorChar(e)?{type:"operator",value:this.readWhile(this.isOperatorChar)}:void this.stream.croak("Can't handle character: "+e)}peek(){return this.current||(this.current=this.readNext())}next(){var e=this.current;return this.current=null,e||this.readNext()}eof(){return null==this.peek()}croak(e){this.stream.croak(e)}}var i={type:"bool",value:!1};function a(e){var r={"=":1,"||":2,"&&":3,"<":7,">":7,"<=":7,">=":7,"==":7,"!=":7,"+=":7,"+":10,"-":10,"*":20,"/":20,"%":20,"**":30};return function(){for(var r=[];!e.eof();)r.push(h()),e.eof()||a(";");return{type:"Program",body:r}}();function t(r){var t=e.peek();return t&&"punctuation"==t.type&&(!r||t.value==r)&&t}function n(r){var t=e.peek();return t&&"keyword"==t.type&&(!r||t.value==r)&&t}function a(r){t(r)?e.next():e.croak('Expecting punctuation: "'+r+'"')}function s(r){n(r)?e.next():e.croak('Expecting keyword: "'+r+'"')}function o(t,n){var i=function(r){var t=e.peek();return t&&"operator"==t.type&&(!r||t.value==r)&&t}();if(i){var a=r[i.value];if(a>n)return e.next(),o({type:"="==i.value?"AssignmentExpression":"BinaryExpression",operator:i.value,left:t,right:o(l(),a)},n)}return t}function u(r,n,i,s){var o=[],u=!0;for(a(r);!e.eof()&&!t(n)&&(u?u=!1:a(i),!t(n));)o.push(s());return a(n),o}function c(){var r=e.next();return"identifier"!=r.type&&e.croak("Expecting variable name"),r.value}function f(e){return e=e(),t("(")?{type:"CallExpression",callee:e,args:u("(",")",",",h)}:e}function l(){return f((function(){if(t("(")){e.next();var r=h();return a(")"),r}if(t("{"))return 0==(o=u("{","}",";",h)).length?i:1==o.length?o[0]:{type:"Program",body:o};var o;if(n("if"))return function(){s("if");var r=h();t("{")||s("then");var i={type:"if",cond:r,then:h()};return n("else")&&(e.next(),i.else=h()),i}();if(n("for"))return function(){s("for");var e=h();s("in");var r=h();return t("{")||s("do"),{type:"ForInStatement",left:e,right:r,body:h()}}();if(t("["))return{type:"ArrayExpression",elements:u("[","]",",",l)};if(n("true")||n("false"))return{type:"bool",value:"true"==e.next().value};if(n("func")||n("λ"))return e.next(),{type:"FunctionDeclaration",vars:u("(",")",",",c),body:h()};var f=e.next();if("identifier"==f.type||"number"==f.type||"string"==f.type)return f;e.croak("Unexpected token: "+JSON.stringify(e.peek()))}))}function h(){return f((function(){return o(l(),0)}))}}function s(e,r){switch(e.type){case"number":case"string":case"boolean":return e.value;case"identifier":return r.get(e.value);case"AssignmentExpression":if("identifier"!=e.left.type)throw new Error("Cannot assign to "+JSON.stringify(e.left));return r.def(e.left.value,s(e.right,r));case"BinaryExpression":return function(e,r,t){function n(e){if("number"!=typeof e)throw new Error("Expected number but got "+e);return e}function i(e){if(0==n(e))throw new Error("Divide by zero");return e}switch(e){case"+":return n(r)+n(t);case"-":return n(r)-n(t);case"*":return n(r)*n(t);case"/":return n(r)/i(t);case"%":return n(r)%i(t);case"&&":return!1!==r&&t;case"||":return!1!==r?r:t;case"<":return n(r)<n(t);case">":return n(r)>n(t);case"<=":return n(r)<=n(t);case">=":return n(r)>=n(t);case"==":return r===t;case"!=":return r!==t;case"**":return Math.pow(r,t)}throw new Error("Can't apply operator "+e)}(e.operator,s(e.left,r),s(e.right,r));case"ForInStatement":return function(e,r){let t=e.extend(),n=r.left.value,i=s(r.right,e);if("number"==typeof i)for(let e=0;e<i;e++)t.def(n,e),s(r.body,t);else if(Array.isArray(i))for(const e of i)t.def(n,e),s(r.body,t);else for(const e in i)t.def(n,e),s(r.body,t)}(r,e);case"FunctionDeclaration":return function(e,r){return function(){for(var t=r.vars,n=e.extend(),i=0;i<t.length;++i)n.def(t[i],i<arguments.length&&arguments[i]);return s(r.body,n)}}(r,e);case"if":return!1!==s(e.cond,r)?s(e.then,r):!!e.else&&s(e.else,r);case"Program":var t=!1;return e.body.forEach((function(e){t=s(e,r)})),t;case"CallExpression":return s(e.callee,r).apply(null,e.args.map((function(e){return s(e,r)})));case"ArrayExpression":return e.elements.map((function(e){return s(e,r)}));default:throw new Error("I don't know how to evaluate "+e.type)}}function o(e){return"const print = (...args) => console.log(...args);"+r(e);function r(e){switch(e.type){case"number":case"string":case"boolean":return function(e){return JSON.stringify(e.value)}(e);case"ArrayExpression":return function(e){return"["+e.elements.map(r).join(", ")+"]"}(e);case"identifier":return function(e){return e.value}(e);case"BinaryExpression":return n(e);case"AssignmentExpression":return function(e){return n(e)}(e);case"let":return function(e){return 0==e.vars.length?r(e.body):"("+r({type:"call",func:{type:"lambda",vars:[e.vars[0].name],body:{type:"let",vars:e.vars.slice(1),body:e.body}},args:[e.vars[0].def||!1]})+")"}(e);case"FunctionDeclaration":return function(e){var n="(function ";return e.name&&(n+=e.name),(n+="("+e.vars.map(t).join(", ")+") {")+"return "+r(e.body)+" })"}(e);case"if":return function(e){return"("+r(e.cond)+" !== false ? "+r(e.then)+" : "+r(e.else||!1)+")"}(e);case"Program":return function(e){return"("+e.body.map(r).join(", ")+")"}(e);case"CallExpression":return function(e){return r(e.callee)+"("+e.args.map(r).join(", ")+")"}(e);case"ForInStatement":return function(e){return r(e.right).startsWith("{")?`for (let ${r(e.left)} in ${r(e.right)}) {\n\t\t\t\t${r(e.body)}\n\t\t\t}`:r(e.right).startsWith("[")?`for (let ${r(e.left)} of ${r(e.right)}) {\n\t\t\t\t${r(e.body)}\n\t\t\t}`:`for (let ${r(e.left)} = 0; ${r(e.left)} < ${r(e.right)}; ${r(e.left)}++) {\n\t\t\t\t${r(e.body)}\n\t\t\t}`}(e);default:throw new Error("Transpilation failed for: "+JSON.stringify(e))}}function t(e){return e}function n(e){return"("+r(e.left)+e.operator+r(e.right)+")"}}class u{constructor(e){this.vars=Object.create(e?e.vars:null),this.parent=e}extend(){return new u(this)}lookup(e){for(var r=this;r;){if(Object.prototype.hasOwnProperty.call(r.vars,e))return r;r=r.parent}}get(e){if(e in this.vars)return this.vars[e];throw new Error("Undefined variable "+e)}set(e,r){var t=this.lookup(e);if(!t&&this.parent)throw new Error("Undefined variable "+e);return(t||this).vars[e]=r}def(e,r){return this.vars[e]=r}}var c=r.qA,f=r.AV,l=r.qd,h=r.Cr,p=r.ku,d=r.Qc;export{c as Environment,f as InputStream,l as TokenStream,h as compileJS,p as evaluate,d as parse};